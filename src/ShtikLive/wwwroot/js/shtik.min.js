var Shtik;(function(n){var t;(function(n){class t{constructor(){this._autoSave=()=>{this._autosaveTimeout&&clearTimeout(this._autosaveTimeout),this._autosaveTimeout=setTimeout(()=>{this.save().then(n=>{n||this._autoSave()})},2e3)};this.load=()=>{this._textarea&&fetch(this.notesUrl,{method:"GET",credentials:"same-origin"}).then(n=>n.text()).then(n=>{const t=JSON.parse(n);this._textarea.value=t.text})};this.save=()=>{if(!this._textarea||!this._setSaving(!0))return Promise.resolve(!1);const i=this._textarea.value,t=JSON.stringify({text:i}),n=new Headers;return n.append("Content-Type","application/json"),n.append("Content-Length",t.length.toString()),fetch(this.notesUrl,{method:"PUT",credentials:"same-origin",body:t,headers:n}).then(()=>this._setSaving(!1),!0).catch(n=>console.log(n),this._setSaving(!1),!1)};this._setSaving=n=>this._saving&&n?!1:(this._saving=this._button.disabled=n,n?this._button.classList.add("disabled"):this._button.classList.remove("disabled"),this._saving);this._form=document.getElementById("notes");!this._form||(this._textarea=this._form.querySelector("textarea"),this._button=this._form.querySelector("button"),window.addEventListener("popstate",this.load),this._textarea&&(this._textarea.addEventListener("keyup",this._autoSave),this._textarea.addEventListener("paste",this._autoSave),this._textarea.addEventListener("focus",()=>this.dirty=!0),this._textarea.addEventListener("blur",()=>this.dirty=!1)))}get notesUrl(){const n=window.location.pathname.split("/"),t=n.pop(),i=n.pop(),r=n.pop();return`/api/notes/${r}/${i}/${t}`}}n.NotesForm=t})(t=n.Notes||(n.Notes={}))})(Shtik||(Shtik={})),function(n){var t;(function(n){class t{constructor(){this.load=()=>{if(this._list){while(this._list.hasChildNodes())this._list.removeChild(this._list.lastChild);fetch(this.questionsUrl,{method:"GET",credentials:"same-origin"}).then(n=>n.text()).then(n=>{const t=JSON.parse(n);for(const n of t)this._appendQuestion(n.id,n.user,n.text)})}};this.save=()=>{if(!this._textarea||!this._setSaving(!0))return Promise.resolve(!1);const i=this._textarea.value,t=JSON.stringify({text:i}),n=new Headers;return n.append("Content-Type","application/json"),n.append("Content-Length",t.length.toString()),fetch(this.questionsUrl,{method:"POST",credentials:"same-origin",body:t,headers:n}).then(()=>this._setSaving(!1),this.dirty=!1,!0).catch(n=>console.log(n),this._setSaving(!1),!1)};this.onMessage=n=>{const t=JSON.parse(n.data);t.MessageType==="question"&&this._appendQuestion(t.Id,t.User,t.Text)};this._appendQuestion=(n,t,i)=>{n=`q${n}`;let r=this._list.querySelector(`#${n}`);r||(r=document.createElement("li"),r.id=n,r.className="list-group-item",r.innerHTML=`<span class="small"><strong>${t}</strong></span><br><span>${i}</span>`,this._list.appendChild(r))};this._onSubmit=n=>{n.preventDefault(),!this._textarea.value||(this.save(),this._textarea.value=null)};this._setSaving=n=>this._saving&&n?!1:(this._saving=this._button.disabled=n,n?this._button.classList.add("disabled"):this._button.classList.remove("disabled"),this._saving);this._form=document.getElementById("questions");!this._form||(this._textarea=this._form.querySelector("textarea"),this._button=this._form.querySelector("button"),this._list=this._form.querySelector("ul#question-list"),window.addEventListener("popstate",this.load),this._form.addEventListener("submit",this._onSubmit),this._textarea&&(this._textarea.addEventListener("keyup",()=>this.dirty=!0),this._textarea.addEventListener("paste",()=>this.dirty=!0),this._textarea.addEventListener("focus",()=>this.dirty=!0)))}get questionsUrl(){const n=window.location.pathname.split("/"),t=n.pop(),i=n.pop(),r=n.pop();return`/api/questions/${r}/${i}/${t}`}}n.QuestionsForm=t})(t=n.Questions||(n.Questions={}))}(Shtik||(Shtik={})),function(n){var t;(function(n){function t(n){return fetch(n,{method:"GET"}).then(n=>n.ok?n.text():null)}class i{constructor(){this.transition=()=>{const n=window.location.href+"/partial";t(n).then(n=>{if(!n){this.goBack();return}const t=JSON.parse(n),i=document.querySelector("article#slide");i.innerHTML=t.html;i.className=t.layout})};this.go=n=>{history.pushState(null,null,n),this.transition()};this.goBack=()=>{const n=location.pathname.split("/"),t=Math.max(parseInt(n.pop())-1,0),i=location.href.replace(/\/[0-9]+$/,`/${t}`);this.go(i)};this._onFirst=()=>{const n=this._currentSlide();if(n.slide!==0){const t=`/live/${n.presenter}/${n.slug}/0`;this.go(t)}};this._onLast=()=>{const n=this._currentSlide(),t=`/live/${n.presenter}/${n.slug}`;history.pushState(null,null,t);window.location.reload()};this._onPrevious=()=>{const n=this._currentSlide();if(n.slide!==0){const t=`/live/${n.presenter}/${n.slug}/${n.slide-1}`;this.go(t)}};this._onNext=()=>{const n=this._currentSlide(),t=`/live/${n.presenter}/${n.slug}/${n.slide+1}`;this.go(t)};this._currentSlide=()=>{const n=location.pathname.split("/"),t=parseInt(n.pop()),i=n.pop(),r=n.pop();return{presenter:r,slug:i,slide:t}};this._first=document.querySelector("button#first-btn");this._first.addEventListener("click",this._onFirst);this._previous=document.querySelector("button#previous-btn");this._previous.addEventListener("click",this._onPrevious);this._next=document.querySelector("button#next-btn");this._next.addEventListener("click",this._onNext);this._last=document.querySelector("button#last-btn");this._last.addEventListener("click",this._onLast);window.addEventListener("popstate",this.transition)}}n.NavButtons=i})(t=n.Nav||(n.Nav={}))}(Shtik||(Shtik={})),function(n){var t;(function(){var f=n.Notes.NotesForm,e=n.Questions.QuestionsForm,o=n.Nav.NavButtons,i,r,u,t;document.addEventListener("DOMContentLoaded",()=>{i=new f;i.load();r=new e;r.load();u=new o;t=new signalR.HubConnection("/realtime");t.on("Send",n=>{if(n.slideAvailable){if(i.dirty||r.dirty)return;u.go(window.location.pathname.replace(/\/[0-9]+$/,`/${n.slideAvailable}`))}});t.start().then(()=>{const n=window.location.pathname.replace(/\/[0-9]+$/,"");t.invoke("Join",n)})})})(t=n.AutoNav||(n.AutoNav={}))}(Shtik||(Shtik={}));